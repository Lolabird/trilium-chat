(()=>{"use strict";var t,e,n,s,i={175:(t,e,n)=>{n.d(e,{Z:()=>r});var s=n(81),i=n.n(s),a=n(645),o=n.n(a)()(i());o.push([t.id,".chat-wrapper .chat_modal {\n  position: fixed;\n  z-index: 1000;\n  display: none;\n  inset: 0;\n}\n.chat-wrapper .chat_modal.show {\n  display: block;\n}\n.chat-wrapper .chat_modal .modal_mask {\n  position: absolute;\n  z-index: -1;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  pointer-events: auto;\n  transition: all 0.3s;\n}\n.chat-wrapper .chat_modal .modal_mask.fadein {\n  background: rgba(0, 0, 0, 0.45);\n}\n.chat-wrapper .chat_modal .content_wrapper {\n  position: absolute;\n  z-index: 1000;\n  background: var(--main-background-color);\n  transition: all 0.3s;\n  will-change: transform, opacity;\n}\n.chat-wrapper .chat_modal .content_wrapper_popup {\n  bottom: 0;\n  width: 100%;\n  height: 70%;\n  border-radius: 8px 8px 0 0;\n  transform: translateY(100%);\n}\n.chat-wrapper .chat_modal .content_wrapper_popup.fadein {\n  transform: translateY(0);\n}\n.chat-wrapper .chat_modal .content_wrapper_dialog {\n  width: calc(100% - 40px);\n  border-radius: 8px;\n  opacity: 0;\n  transform: scale(0.1);\n}\n.chat-wrapper .chat_modal .content_wrapper_dialog.fadein {\n  top: 30% !important;\n  left: 20px !important;\n  opacity: 1;\n  transform: scale(1);\n}\n.chat-wrapper .chat_popover {\n  position: absolute;\n  opacity: 0;\n  will-change: transform, opacity, top, left, right, top;\n}\n.chat-wrapper .chat_popover .tooltip-text {\n  padding: 6px;\n  border: 1px solid var(--main-border-color);\n  background: var(--main-background-color);\n  border-radius: 4px;\n}\n.chat-wrapper .chat_popover.fadein {\n  opacity: 1;\n  transform: scale(1) !important;\n}\n.chat-wrapper .form_wrapper {\n  padding: 10px 16px;\n}\n.chat-wrapper .form_wrapper .wapper_title {\n  font-size: 120%;\n}\n.chat-wrapper .form_wrapper .wrapper_op {\n  margin-top: 3px;\n  text-align: right;\n}\n.chat-wrapper .form_wrapper .chat_button {\n  display: inline-block;\n  width: 70px;\n  border-color: var(--main-text-color);\n}\n.chat-wrapper .form_wrapper .wrapper_btn_save {\n  border: none;\n  background: var(--trilium-green);\n  color: var(--main-background-color);\n}\n.chat-wrapper .form_wrapper .wrapper_btn_save:hover {\n  opacity: 0.8;\n}\n.chat-wrapper .form_wrapper .wrapper_btn_cancel {\n  border: 1px solid var(--main-border-color);\n  color: var(--main-border-color);\n}\n.chat-wrapper .form_wrapper .wrapper_btn_cancel:hover {\n  border: 1px solid var(--trilium-green);\n  color: var(--trilium-green);\n}\n.chat-wrapper .thread {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  padding: 10px;\n  padding-bottom: 50px;\n  border-bottom: 1px solid var(--main-border-color);\n  background: var(--left-pane-background-color);\n  overflow-y: auto;\n  scroll-behavior: smooth;\n}\n.chat-wrapper .thread .message {\n  display: flex;\n  max-width: 80%;\n  flex-direction: column;\n  padding: 8px 10px;\n  margin-bottom: 10px;\n}\n.chat-wrapper .thread .received {\n  align-self: flex-start;\n  background-color: var(--main-background-color);\n  border-radius: 2px 12px 12px;\n}\n.chat-wrapper .thread .sent {\n  align-self: flex-end;\n  background-color: var(--trilium-green);\n  border-radius: 12px 2px 12px 12px;\n  color: #fff;\n}\n.chat-wrapper .operate {\n  display: flex;\n  height: 210px;\n  flex-direction: column;\n  padding: 0 16px;\n}\n.chat-wrapper .operate .operate_top {\n  height: 44px;\n}\n.chat-wrapper .operate .operate_top .operate_btn {\n  margin-right: 2px;\n  color: #666;\n}\n.chat-wrapper .operate .operate_top .operate_btn_new:hover {\n  border-color: var(--trilium-green);\n  color: var(--trilium-green) !important;\n}\n.chat-wrapper .operate .operate_input {\n  position: relative;\n  flex: 1;\n}\n.chat-wrapper .operate .operate_input .input-area {\n  width: 100%;\n  height: 100%;\n  padding: 6px 8px;\n  border: none;\n  border: 1px solid var(--main-border-color);\n  background-color: var(--main-background-color) !important;\n  border-radius: 8px;\n  outline: none;\n  resize: none;\n  transition: border 0.2s;\n  /*  &::placeholder {\n                color: #ddd;\n            } */\n}\n.chat-wrapper .operate .operate_input .input-area:focus {\n  border: 1px solid var(--trilium-green);\n}\n.chat-wrapper .operate .operate_input .operate_send {\n  position: absolute;\n  right: 6px;\n  bottom: 6px;\n  color: var(--trilium-green);\n}\n.chat-wrapper .operate .operate_input .operate_send.freezed {\n  color: var(--main-border-color);\n}\n.chat-wrapper .operate .operate_bottom {\n  height: 36px;\n}\n.chat-wrapper .operate .operate_bottom .thread_op {\n  display: none;\n  border: 1px solid var(--main-border-color);\n  background: var(--main-background-color);\n  border-radius: 8px;\n}\n.chat-wrapper .operate .operate_bottom .thread_op.show {\n  display: block;\n}\n.chat-wrapper .content_select {\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n  user-select: none;\n}\n.chat-wrapper .content_select .select_top {\n  height: 44px;\n  padding-right: 4px;\n  padding-left: 16px;\n  border-bottom: 1px solid var(--main-border-color);\n}\n.chat-wrapper .content_select .select_search {\n  height: 40px;\n  padding: 0 10px;\n  border: 1px solid var(--main-border-color);\n  margin: 10px 16px;\n  border-radius: 8px;\n}\n.chat-wrapper .content_select .bx-search {\n  font-size: 120%;\n}\n.chat-wrapper .content_select .select_search_input {\n  flex: 1;\n  margin-left: 4px;\n}\n.chat-wrapper .content_select .select_list {\n  flex: 1;\n  padding: 0 16px;\n  overflow-y: auto;\n}\n.chat-wrapper .content_select .select_item {\n  position: relative;\n  padding: 8px;\n  border-radius: 8px;\n  color: var(--inactive-tab-text-color);\n  cursor: pointer;\n  font-size: 90%;\n}\n.chat-wrapper .content_select .select_item::after {\n  position: absolute;\n  bottom: 0;\n  width: calc(100% - 16px);\n  border-bottom: 1px solid var(--left-pane-background-color);\n  content: '';\n}\n.chat-wrapper .content_select .select_item:hover {\n  background: var(--left-pane-background-color);\n}\n.chat-wrapper .content_select .select_item .item_title {\n  color: var(--main-text-color);\n  font-weight: 700;\n}\n.chat-wrapper .content_select .select_item .item_stamp {\n  font-size: 80%;\n}\n.chat-wrapper .popover_prompt {\n  width: 100%;\n  height: 300px;\n  min-height: 300px;\n  background: var(--main-background-color);\n  box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);\n}\n.chat-wrapper .content_select_prompt .item_up {\n  position: relative;\n}\n.chat-wrapper .content_select_prompt .item_title {\n  padding-right: 60px;\n}\n.chat-wrapper .content_select_prompt .item_op {\n  position: absolute;\n  top: 0;\n  right: 0;\n  display: none;\n}\n.chat-wrapper .content_select_prompt .item_op .icon-action {\n  width: 24px;\n  height: 24px;\n  padding: 0;\n}\n.chat-wrapper .content_select_prompt .select_item:hover .item_op {\n  display: block;\n}\n.chat-wrapper {\n  position: fixed;\n  z-index: 1000;\n  top: 40px;\n  right: 0;\n  display: flex;\n  overflow: hidden;\n  width: 420px;\n  min-width: 420px;\n  max-width: calc(100% - 40px);\n  height: calc(100% - 40px);\n  flex-direction: column;\n  border: 1px solid var(--main-border-color);\n  border-right: none;\n  border-bottom: none;\n  background: var(--main-background-color);\n  border-radius: 8px 0 0 8px;\n  box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1);\n  transform: translate3d(120%, 0, 0);\n  transition: transform 0.3s;\n  visibility: visible !important;\n  will-change: width;\n  --trilium-green: #50a52c;\n}\n.chat-wrapper *::-webkit-scrollbar {\n  width: 6px;\n}\n.chat-wrapper input {\n  border: none;\n  outline: none;\n}\n.chat-wrapper * {\n  box-sizing: border-box;\n}\n.chat-wrapper.show {\n  transform: translateZ(0);\n}\n.chat-wrapper .flex-center {\n  display: flex;\n  align-items: center;\n}\n.chat-wrapper .flex-center-between {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.chat-wrapper .flex-row-reverse {\n  display: flex;\n  flex-direction: row-reverse;\n  align-items: center;\n}\n.chat-wrapper .no-shrink {\n  flex-shrink: 0;\n}\n.chat-wrapper .one-line {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.chat-wrapper .link,\n.chat-wrapper .link:visited,\n.chat-wrapper .link:hover {\n  color: inherit;\n  text-decoration: none;\n}\n.chat-wrapper .icon-view {\n  font-size: 180%;\n}\n.chat-wrapper .icon-action {\n  width: 36px;\n  height: 36px;\n}\n.chat-wrapper .chat_button {\n  padding: 5px 8px;\n  border: 1px solid var(--button-border-color);\n  background: var(--button-background-color);\n  border-radius: 8px;\n  color: var(--main-text-color);\n  cursor: pointer;\n  text-align: center;\n  transition: all 0.2s;\n  user-select: none;\n}\n.chat-wrapper .chat_button:hover {\n  text-decoration: none;\n}\n.chat-wrapper .chat_button:disabled {\n  cursor: not-allowed;\n}\n.chat-wrapper .resizer {\n  position: absolute;\n  z-index: 1;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  width: 8px;\n  cursor: e-resize;\n  user-select: none;\n}\n.chat-wrapper .header {\n  display: flex;\n  height: 37px;\n  align-items: center;\n  justify-content: space-between;\n  padding-left: 10px;\n  border-bottom: 1px solid var(--main-border-color);\n}\n.chat-wrapper .header .header_hide {\n  border-radius: 0;\n}\n.chat-wrapper .header .header_hide:hover {\n  border: 1px solid transparent;\n  background: var(--left-pane-background-color);\n}\n.chat-wrapper .prompt_content {\n  overflow: hidden;\n  height: 0;\n  flex-shrink: 0;\n  background: var(--main-background-color);\n  transition: height 0.3s;\n}\n.chat-wrapper .prompt_content.show {\n  max-height: 200px;\n  border-bottom: 1px solid var(--main-border-color);\n}\n.chat-wrapper .prompt_content .prompt_content_close {\n  height: 40px;\n  padding-right: 4px;\n  border-bottom: 1px solid var(--main-border-color);\n}\n.chat-wrapper .prompt_content .prompt_content_text {\n  max-height: 160px;\n  padding: 10px;\n  overflow-y: auto;\n}\n.chat-wrapper .content_command {\n  background: var(--main-background-color);\n  border-radius: 8px;\n  box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);\n  user-select: none;\n}\n.chat-wrapper .content_command .command_title {\n  padding-left: 10px;\n  border-bottom: 1px solid var(--main-border-color);\n  line-height: 36px;\n}\n.chat-wrapper .content_command .command_item {\n  padding: 4px 10px;\n  cursor: pointer;\n}\n.chat-wrapper .content_command .command_item:hover {\n  background: var(--left-pane-background-color);\n}\n.chat-wrapper .content_prompt_form label {\n  display: block;\n}\n.chat-wrapper .content_prompt_form .prompt_input {\n  width: 100%;\n  padding-left: 8px;\n  border: 1px solid var(--main-border-color);\n  border-radius: 8px;\n  line-height: 30px;\n  transition: all 0.3s;\n}\n.chat-wrapper .content_prompt_form .prompt_input:focus {\n  border-color: var(--trilium-green);\n}\n.chat-wrapper .content_prompt_form .prompt_input_content {\n  min-height: 170px;\n  outline: none;\n  resize: none;\n}\n",""]);const r=o},447:(t,e,n)=>{n.d(e,{Z:()=>r});var s=n(81),i=n.n(s),a=n(645),o=n.n(a)()(i());o.push([t.id,".chat-toggle-wrapper {\n  display: flex;\n  height: 100%;\n}\n.chat-toggle-wrapper .button-widget {\n  font-size: 1.5em !important;\n  line-height: 1 !important;\n}\n",""]);const r=o},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",s=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),s&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),s&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,s,i,a){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var r=0;r<this.length;r++){var c=this[r][0];null!=c&&(o[c]=!0)}for(var h=0;h<t.length;h++){var l=[].concat(t[h]);s&&o[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},81:t=>{t.exports=function(t){return t[1]}},396:(t,e,n)=>{n.d(e,{Z:()=>f});var s=n(379),i=n.n(s),a=n(795),o=n.n(a),r=n(569),c=n.n(r),h=n(565),l=n.n(h),p=n(216),d=n.n(p),m=n(589),u=n.n(m),g=n(447),v={};v.styleTagTransform=u(),v.setAttributes=l(),v.insert=c().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=d(),i()(g.Z,v),g.Z&&g.Z.locals&&g.Z.locals;var w=n(46);class f extends w.Z{initSkeleton(t="body"){const e=document.$qs(t),n=document.createElement("template");n.innerHTML='<div class="chat-wrapper"><div class="resizer"></div><div class="header"><div class="header_left flex-center"><a class="link link_face flex-center no-arrow" href="https://github.com/soulsands/trilium-chat" target="_blank"><i class="header_face bx icon-view" title="HomePage"></i></a></div><div class="header_right"><i title="hide" class="header_hide bx bx-minus icon-action"></i></div></div><div class="thread"></div><div class="prompt_content"><div class="prompt_content_close flex-row-reverse"><i class="bx bx-x icon-action"></i></div><div class="prompt_content_text"></div></div><div class="operate no-shrink"><div class="operate_top flex-center-between"><div class="operate_top_left flex-center"><button class="operate_btn operate_btn_new chat_button">New Chat</button><div class="operate_btn operate_btn_prompt bx bx-book-bookmark icon-action" title="Prompt"></div><div class="operate_btn operate_btn_command bx bx-terminal icon-action" title="Command"></div></div><div class="operate_top_right"><div class="operate_btn operate_btn_history bx bx-history icon-action" title="History"></div></div></div><div class="operate_input"><textarea class="input-area" placeholder="Send a message..."></textarea> <i title="Send(Enter to send, Shift+Enter to break line)" class="operate_send bx bx-paper-plane icon-action"></i></div><div class="operate_bottom flex-center-between"><div><button class="thread_op thread_op_stop">stop generating</button> <button class="thread_op thread_op_regenerate">regenerate</button></div><div class="operate_status"></div></div></div><div class="content_select content_select_prompt"><div class="select_top flex-center-between"><div class="flex-center"><div class="select_count">Prompt(<span class="select_num">0</span>)</div><div class="ml-2 select_add bx bx-plus icon-action"></div></div><div class="select_close bx bx-chevron-down icon-action"></div></div><div class="select_search flex-center"><i class="bx bx-search"></i> <input class="select_search_input" placeholder="Search"/></div><div class="select_list"><div class="select_item"><div class="item_up"><div class="item_title one-line"></div><div class="item_op no-shrink"><i class="bx bx-edit-alt icon-action"></i> <i class="bx bx-trash icon-action"></i></div></div><div class="item_preview one-line"></div></div></div></div><form class="content_prompt_form"><label>Prompt Name:</label> <input class="prompt_input" placeholder="Name your prompt" name="prompt-name"/> <label class="mt-1">Prompt Content:</label> <textarea class="prompt_input prompt_input_content" placeholder="Paste or input content here" type="tex" name="prompt-content"></textarea></form><div class="content_select content_select_history"><div class="select_top flex-center-between"><div class="select_count">History(<span class="select_num"></span>)</div><div class="select_close bx bx-chevron-down icon-action"></div></div><div class="select_search flex-center"><i class="bx bx-search"></i> <input class="select_search_input" placeholder="Search"/></div><div class="select_list"><div class="select_item"><div class="flex-center-between item_up"><div class="item_title one-line"></div><div class="item_stamp no-shrink"></div></div><div class="flex-center-between item_down"><div class="item_preview one-line"></div>\x3c!-- <div class="item_op no-shrink">\n                                <div class="item_op_delete">asdfasd</div>\n                            </div> --\x3e</div></div></div></div><div class="content_command"><div class="command_title">Commands</div><div class="command_list"><div class="command_item" command="copy">copy thread</div><div class="command_item" command="history">save to history</div><div class="command_item" command="favor">favor in history</div><div class="command_item" command="unfavor">unfavor in history</div><div class="command_item" command="save">save to active note</div><div class="command_item" command="append">append to active note</div><div class="command_item" command="child">save to new child</div></div></div></div>',this.$chatView=n.content.lastChild,e.appendChild(this.$chatView)}appendToggleBtn(){console.log(this);const t=class extends api.NoteContextAwareWidget{isEnabled(){return!0}constructor(t){super(),this.options=t}doRender(){this.$widget=$('<div class="chat-toggle-wrapper flex-row-reverse"><button class="button-widget bx icon-action"\n      data-toggle="tooltip"\n      title=""></button></div>');const t=this.$widget.find(".button-widget");t.attr("data-placement","bottom"),t.tooltip({html:!0,title:"Chat",trigger:"hover"}),t.addClass("bx-message-square-dots"),t.on("click",this.options.onClick),this.$btn=t,super.doRender()}},e=new t({onClick:()=>{e.$btn.tooltip("hide"),this.toggleView()}});$(".tab-row-filler").prepend(e.render())}bindShortcut(){const{toggle:t,hide:e}=this.options.shortcut;api.bindGlobalShortcut(t,(()=>{this.toggleView()})),api.bindGlobalShortcut(e,(()=>{this.hideView()}))}}},379:t=>{var e=[];function n(t){for(var n=-1,s=0;s<e.length;s++)if(e[s].identifier===t){n=s;break}return n}function s(t,s){for(var a={},o=[],r=0;r<t.length;r++){var c=t[r],h=s.base?c[0]+s.base:c[0],l=a[h]||0,p="".concat(h," ").concat(l);a[h]=l+1;var d=n(p),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(m);else{var u=i(m,s);s.byIndex=r,e.splice(r,0,{identifier:p,updater:u,references:1})}o.push(p)}return o}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var a=s(t=t||[],i=i||{});return function(t){t=t||[];for(var o=0;o<a.length;o++){var r=n(a[o]);e[r].references--}for(var c=s(t,i),h=0;h<a.length;h++){var l=n(a[h]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}a=c}}},569:t=>{var e={};t.exports=function(t,n){var s=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,i&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},605:(t,e,n)=>{n.d(e,{Z:()=>s});class s{constructor(){this.listeners={}}addEventListener(t,e){this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e)}on(t,e){return this.addEventListener(t,e)}removeEventListener(t,e){if(!this.listeners[t])return;const n=[];for(let s=0;s<this.listeners[t].length;s+=1)this.listeners[t][s]!==e&&n.push(this.listeners[t][s]);0===this.listeners[t].length?delete this.listeners[t]:this.listeners[t]=n}off(t,e){return this.removeEventListener(t,e)}dispatchEvent(t){if(!t)return!0;t.source=this;const e=`on${t.type}`;return(!Object.hasOwnProperty.call(this,e)||(this[e].call(this,t),!t.defaultPrevented))&&(!this.listeners[t.type]||this.listeners[t.type].every((e=>(e(t),!t.defaultPrevented))))}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((t=>{t(...e)}))}}},471:(t,e,n)=>{n.d(e,{Z:()=>o});var s=n(257),i=n(624),a=n(605);class o extends a.Z{async initOptions(){const t=await this.getOptions();if(!t)return this.setDefaultOptions();if(!(0,i.tY)(s.WN,t))return t;const e=(0,i.Yo)(t,s.WN);return this.setOptions(e)}async initPrompts(){if(!await this.getPrompts())return this.setDefaultPrompts()}async getOptions(){(0,i.de)()}async setOption(t,e){this.emit(s.bs.setStatus,{status:s.f5.optionSyncing,key:t,value:e});const n=await this.getOptions();n[t]=e,await this.setOptions(n),this.emit(s.bs.setStatus,{status:s.f5.success,key:t,value:e})}async setOptions(){(0,i.de)()}async setDefaultOptions(){(0,i.de)()}async getOption(t){return(await this.getOptions())[t]}async getPrompts(){(0,i.de)()}async setPrompts(){(0,i.de)()}async setDefaultPrompts(){(0,i.de)()}async createPrompt(t){const e=await this.getPrompts(),n={...t,order:e.length};e.push(n),await this.setPrompts(e)}async updatePrompt(t,e){const n=await this.getPrompts(),s=n.findIndex((e=>e.id===t.id));if(-1===s)throw new Error("can't find target prompt");e?n.splice(s,1):n.splice(s,1,t),await this.setPrompts(n)}async deletePrompt(t){await this.updatePrompt(t,!0)}getAcitveNoteContent(){(0,i.de)()}async handleCommand(t,e){console.log(t,e);const n={copy:this.handleCopy.bind(this),favor:this.handleFavor.bind(this),unfavor:this.handleUnfavor.bind(this),save:this.handleSaveNote.bind(this),append:this.handleAppend.bind(this),child:this.handleSaveChild.bind(this),history:this.handleSaveHistory.bind(this)};n[t]&&await n[t](e)}threadToText(t,e,n){let s=t.thread.map((t=>`<p>role: ${t.role}</p><p>${t.content}</p>`)).join("");return n&&(s=t.thread.map((t=>`role: ${t.role}\n${t.content}`)).join("\n")),s||(0,i._o)(e,"no content"),s}handleCopy(t){const e=this.threadToText(t,s.xL.copy,!0);(0,i.JG)(e)}async handleFavor(t){await this.toggleFavor(t,!0)}async handleUnfavor(t){await this.toggleFavor(t,!1)}async toggleFavor(t,e){const n=await this.getRecord(t.threadId);n||(0,i._o)(e?s.xL.favor:s.xL.unfavor,"no thread"),n.favor=e,await this.saveRecord(n)}handleSaveNote(){(0,i.de)()}handleAppend(){(0,i.de)()}handleSaveChild(){(0,i.de)()}async handleSaveHistory(t){await this.saveRecordFromEngine(t)}async getRecords(){(0,i.de)()}async saveRecord(){(0,i.de)()}async handleMsgStatus(t,e){if(!e.thread.length)return;const n=[s.S2.success,s.S2.cancel].includes(t),i=e.lastMessage.role===s.HB.assistant;n&&i&&this.saveRecordFromEngine(e)}async saveRecordFromEngine(t){const e=t.thread.find((t=>t.role===s.HB.user));e||(0,i._o)(s.xL.history,"no content");const n={id:t.threadId,originTitle:e.content,list:t.thread.map((t=>{const e={...t};return delete e.status,e}))};await this.saveRecord(n)}}},300:(t,e,n)=>{n.d(e,{Z:()=>c});var s=n(624),i=n(257),a=n(471);async function o(t){await(0,s._v)(200);const e=localStorage.getItem(t);return JSON.parse(e)}async function r(t,e){return await(0,s._v)(200),localStorage.setItem(t,JSON.stringify(e)),{...e}}class c extends a.Z{async getOptions(){return o(i.cT.CHAT_OPTIONS)}async setOptions(t){return r(i.cT.CHAT_OPTIONS,t)}async setDefaultOptions(){return r(i.cT.CHAT_OPTIONS,i.WN)}getPrompts(){return o(i.cT.CHAT_PROMPTS)}async setPrompts(t){return r(i.cT.CHAT_PROMPTS,t)}async setDefaultPrompts(){return r(i.cT.CHAT_PROMPTS,i.HT)}async getAcitveNoteContent(){throw await(0,s.j1)(),this.emit(i.bs.setStatus,{status:i.f5.faild,key:"noteId",value:"file"}),new Error("not supported")}async getRecords(){return await o(i.cT.HISTORY_HOME_LABEL)||[]}async getRecord(t){return(await this.getRecords()).find((e=>e.id===t))}async saveRecord(t){const e=await this.getRecords(),n=e.findIndex((e=>e.id===t.id));return-1!==n?e.splice(n,1,t):e.push(t),r(i.cT.HISTORY_HOME_LABEL,e)}emitTriliumOnly(t){(0,s._o)(t,i.Ve)}handleSaveNote(){this.emitTriliumOnly(i.xL.save)}handleAppend(){this.emitTriliumOnly(i.xL.append)}handleSaveChild(){this.emitTriliumOnly(i.xL.child)}}},0:(t,e,n)=>{n.d(e,{Z:()=>o});var s=n(257),i=n(624),a=n(471);class o extends a.Z{async getOptions(){return api.runOnBackend((async t=>{const e=api.getNoteWithLabel(t);if(!e)return null;return e.getJsonContent()||null}),[s.cT.CHAT_OPTIONS])}async setOptions(t){return await api.runOnBackend((async(t,e)=>{const n=JSON.stringify(e,null,"\t"),s=api.getNoteWithLabel(t);s?s.setContent(n):api.createNewNote({parentNoteId:api.currentNote.noteId,title:"CHAT_OPTIONS: reload to take effect",content:n,type:"code",mime:"application/json"}).note.setLabel(t)}),[s.cT.CHAT_OPTIONS,t]),{...t}}async setDefaultOptions(){return this.setOptions(s.WN)}async getPrompts(){return api.runOnBackend((async t=>{const e=api.getNoteWithLabel(t);if(!e)return null;return e.getJsonContent()||null}),[s.cT.CHAT_PROMPTS])}async setPrompts(t){return await api.runOnBackend((async(t,e)=>{const n=JSON.stringify(e,null,"\t"),s=api.getNoteWithLabel(t);s?s.setContent(n):api.createNewNote({parentNoteId:api.currentNote.noteId,title:"CHAT_PROMPTS",content:n,type:"code",mime:"application/json"}).note.setLabel(t)}),[s.cT.CHAT_PROMPTS,t]),{...t}}async setDefaultPrompts(){return this.setPrompts(s.HT)}async getAcitveNoteContent(){const t=api.getActiveContextNote();let e=null;if("text"===t.type){const t=document.querySelector(".note-detail-editable-text");e="block"===window.getComputedStyle(t).display?t.querySelector(".note-detail-editable-text-editor").textContent:document.querySelector(".note-detail-readonly-text-content").textContent}else"code"===t.type&&(e=(await t.getNoteComplement()).content);if(null===e)throw this.emit(s.bs.setStatus,{status:s.f5.faild,key:"acitveNote",value:`type ${t.type} not supported`}),new Error("not supported");return this.emit(s.bs.setStatus,{status:s.f5.success}),e}async getRecords(){return api.runOnBackend((async t=>(api.getNotesWithLabel(t)||[]).map((t=>({...t.getJsonContent(),title:t.title})))),[s.cT.HISTORY_LABEL])}async getRecord(t){return api.runOnBackend((async(t,e)=>{const n=api.getNoteWithLabel(t,e);return n?{...n.getJsonContent(),title:n.title}:null}),[s.cT.HISTORY_LABEL,t])}async saveRecord(t){return await api.runOnBackend((async(t,e,n)=>{const s=api.getNoteWithLabel(e,`${n.id}`),i=JSON.stringify(n,null,"\t");if(s)s.setContent(i);else{const s=api.getNoteWithLabel(t)||api.currentNote;api.createNewNote({parentNoteId:s.noteId,title:n.originTitle,content:i,type:"code",mime:"application/json"}).note.setLabel(e,n.id)}}),[s.cT.HISTORY_HOME_LABEL,s.cT.HISTORY_LABEL,t]),{...t}}async handleSaveNote(t){const e=this.threadToText(t,s.xL.save),n=api.getActiveContextNote();try{await api.runOnBackend((async(t,e)=>{const n=api.getNote(t);if(!n)throw new Error("[no active note]");if("text"!==n.type)throw new Error("[not text note]");return n.setContent(e),!0}),[n.noteId,e])}catch(t){this.throwServerError(s.xL.save,t.message)}}throwServerError(t,e){const n=e.match(/\[(.*)\]/)[1];(0,i._o)(t,n)}async handleAppend(t){const e=this.threadToText(t,s.xL.append),n=api.getActiveContextNote();try{await api.runOnBackend((async(t,e)=>{const n=api.getNote(t);if(!n)throw new Error("[no active note]");if("text"!==n.type)throw new Error("[not text note]");const s=n.getContent();n.setContent(`${s}${e}`)}),[n.noteId,e])}catch(t){this.throwServerError(s.xL.save,t.message)}}async handleSaveChild(t){const e=this.threadToText(t,s.xL.child),n=api.getActiveContextNote(),i=t.thread[0];try{await api.runOnBackend((async(t,e,n)=>{if(!api.getNote(t))throw new Error("[no active note]");return api.createNewNote({parentNoteId:t,title:e,content:n,type:"text"}).note}),[n.noteId,i.content,e])}catch(t){this.throwServerError(s.xL.save,t.message)}}}},926:(t,e,n)=>{n.d(e,{Z:()=>r});var s=n(257),i=n(605);class a extends i.Z{constructor(t,e={}){super(),this.url=t,this.method=e.method||"GET",this.headers=e.headers||{},this.payload=e.payload||null,this.withCredentials=e.withCredentials||!1,this.readyState=this.CONNECTING,this.progress=0,this.chunk="",this.xhr=null,this.FIELD_SEPARATOR=":",this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2}_setReadyState(t){const e=new CustomEvent("readyStateChange");e.readyState=t,this.readyState=t,this.dispatchEvent(e)}_onStreamFailure(t){const e=new CustomEvent("error");e.data=t.currentTarget.response,this.dispatchEvent(e),this.close()}_onStreamAbort(){this.close()}_onStreamProgress(t){if(!this.xhr)return;if(200!==this.xhr.status)return void this._onStreamFailure(t);this.readyState===this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));const e=this.xhr.responseText.substring(this.progress);this.progress+=e.length,e.split(/(\r\n|\r|\n){2}/g).forEach((t=>{0===t.trim().length?(this.dispatchEvent(this._parseEventChunk(this.chunk.trim())),this.chunk=""):this.chunk+=t}))}_onStreamLoaded(t){this._onStreamProgress(t),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""}_parseEventChunk(t){if(!t||0===t.length)return null;const e={id:null,retry:null,data:"",event:"message"};t.split(/(\r\n|\r|\n)/).forEach((t=>{const n=t.trimRight(),s=n.indexOf(this.FIELD_SEPARATOR);if(s<=0)return;const i=n.substring(0,s);if(!(i in e))return;const a=n.substring(s+1).trimLeft();"data"===i?e[i]+=a:e[i]=a}));const n=new CustomEvent(e.event);return n.data=e.data,n.id=e.id,n}_checkStreamClosed(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)}stream(){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url),Object.keys(this.headers).forEach((t=>{this.xhr.setRequestHeader(t,this.headers[t])})),this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}close(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))}}const o="...";class r extends i.Z{constructor({apiKey:t,engineOptions:e,systemPrompt:n}){super(),this.urls={completion:"https://api.openai.com/v1/chat/completions"},this.apiKey=t,this.defaultOptions=e,this.systemPrompt=n}get lastMessage(){return this.thread.length?this.thread[this.thread.length-1]:null}set lastMessage(t){if(!this.thread[this.thread.length-1])throw new Error("lastMessage not exist");this.thread[this.thread.length-1]=t}newChat(){const t=[];this.systemPrompt&&t.push({role:s.HB.system,content:this.systemPrompt,status:s.S2.success}),this.loadThread({id:Date.now().toString(),list:t}),this.emit(s.TH.setStatus,s.S2.none)}loadThread(t){this.endStream(),this.threadId=t.id,this.thread=t.list.map((t=>({...t,status:s.S2.success}))),this.emit(s.TH.load,this.thread)}isEngineAvailable(){return!this.lastMessage||[s.S2.success,s.S2.cancel].includes(this.lastMessage.status)}setLastMessageStatus(t){this.lastMessage.status!==t&&(this.lastMessage.status=t,t===s.S2.success&&(this.lastMessage.stamp=Date.now()),this.emit(s.TH.setStatus,t))}createMessage(t,e=s.HB.user){const n={role:e,content:t};this.thread.push(n);const i=e===s.HB.user?s.S2.success:s.S2.fetching;this.setLastMessageStatus(i),this.emit(s.TH.create,{...this.lastMessage})}replaceMessage(t,e,n){if(!t)throw new Error("content required");this.lastMessage.content=t,this.lastMessage.role=n||this.lastMessage.role,this.setLastMessageStatus(e||this.lastMessage.status),this.emit(s.TH.replace,{...this.lastMessage})}appendMessageWords(t){this.lastMessage&&(this.lastMessage.content+=t,this.emit(s.TH.append,{word:t,...this.lastMessage}))}requestCompletion({userInput:t,overrideOptions:e={}}){const n="string"==typeof t&&""===t.trim();if(t&&!n)return this.createMessage(t),this.createMessage(o,s.HB.assistant),this.sendRequest(e)}async sendRequest(t={}){const e={messages:this.thread.reduce(((t,e)=>(e.status!==s.S2.success&&e.status!==s.S2.cancel||t.push({role:e.role,content:e.content}),t)),[]),...this.defaultOptions,...t};if(this.apiKey)try{e.stream?await this.requestChatStream(e):await this.requestChatBatch(e)}catch(t){console.error(t),this.replaceMessage("API Error. See console logs for details.",s.S2.faild,s.HB.error)}else this.replaceMessage("please config your apikey in options file",s.S2.faild,s.HB.error)}regenerate(t){if(this.lastMessage.role===s.HB.user)throw new Error("error detected!");this.replaceMessage(o,s.S2.fetching,s.HB.assistant),this.sendRequest(t)}async requestChatStream(t){await new Promise(((e,n)=>{try{this.activeStream=new a(this.urls.completion,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},method:"POST",payload:JSON.stringify(t)});let i="";this.activeStream.addEventListener("message",(t=>{if("[DONE]"!==t.data){const e=JSON.parse(t.data).choices[0].delta.content;if(!e)return;i+=e,this.lastMessage.content===o?this.replaceMessage(e,s.S2.generating):this.appendMessageWords(e)}else this.endStream(),this.setLastMessageStatus(s.S2.success),e(i)})),this.activeStream.addEventListener("readystatechange",(t=>{t.readyState>=2&&console.log(`ReadyState: ${t.readyState}`)})),this.activeStream.addEventListener("error",(t=>{this.endStream(),n(t)})),this.emit("beforeStream",{role:s.HB.assistant}),this.activeStream.stream()}catch(t){this.endStream(),n(t)}}))}cencelGenerating(){this.setLastMessageStatus(s.S2.cancel),this.emit(s.TH.cancel,{...this.lastMessage}),this.endStream()}endStream(){this.activeStream&&(this.activeStream.close(),this.activeStream=null)}async requestChatBatch(t){const e=await this.requestCompletionBatch(t);this.replaceMessage(e,s.S2.success)}async requestCompletionBatch(t){const e=await fetch(this.urls.completion,{method:"POST",mode:"cors",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),{content:n}=(await e.json()).choices[0].message;return n}}},46:(t,e,n)=>{n.d(e,{Z:()=>R});var s=n(379),i=n.n(s),a=n(795),o=n.n(a),r=n(569),c=n.n(r),h=n(565),l=n.n(h),p=n(216),d=n.n(p),m=n(589),u=n.n(m),g=n(175),v={};v.styleTagTransform=u(),v.setAttributes=l(),v.insert=c().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=d(),i()(g.Z,v),g.Z&&g.Z.locals&&g.Z.locals;var w=n(605),f=n(257),b=n(624);class _{constructor(t){this.chatView=t,this.$thread=t.$chatView.$qs(".thread"),this.isHovering=!1,this.wrapFunction(),this.bindThreadHover(),this.bindEngineEvents()}wrapFunction(){this.scrolToBottom=(0,b.P2)(this.scrolToBottom,300)}bindThreadHover(){this.$thread.addEventListener("mouseenter",(()=>{this.isHovering=!0})),this.$thread.addEventListener("mouseleave",(()=>{this.isHovering=!1}))}bindEngineEvents(){const{chatEngine:t}=this.chatView;t.on(f.TH.load,(t=>{this.renderThread(t)})),t.on(f.TH.create,(t=>{this.appendElByMessage(t)})),t.on(f.TH.append,(t=>{this.replaceCurrentElContent(t.content)})),t.on(f.TH.replace,(t=>{this.replaceCurrentElContent(t.content)}))}renderThread(t){this.$thread.innerHTML="",t.forEach((t=>{this.appendElByMessage(t)}))}appendElByMessage(t){if(t.role==f.HB.system)return;const e=document.createElement("div");e.classList.add("message"),e.classList.add("user"===t.role?"sent":"received");const n=document.createElement("div");return n.textContent=t.content,e.appendChild(n),this.$thread.appendChild(e),this.scrolToBottom(),e}scrolToBottom(){this.$thread.scrollTop=1e11}getCurrentMsgDom(){const{children:t}=this.$thread;return t[t.length-1]}replaceCurrentElContent(t){this.getCurrentMsgDom().children[0].textContent=t,this.isHovering||this.scrolToBottom()}removeCurrentEl(){const t=this.getCurrentMsgDom();(0,b.hX)(t)}}class y extends w.Z{constructor(t){super(),this.view=t,this.$chatView=t.$chatView,this.$resizer=this.$chatView.$qs(".resizer"),this.bindResize()}bindResize(){let t=-1,e=-1,n=-1;const s=s=>{s.stopPropagation(),(0,b.rs)((()=>{n=e+(t-s.x),this.$chatView.style.width=`${n}px`}),"handleMousemove")},i=t=>{t.stopPropagation(),document.body.style.cursor=null,this.view.chatData.setOption(f.PV.viewWidth,n),document.removeEventListener("mousemove",s,!0),document.removeEventListener("mouseup",i)};this.$resizer.addEventListener("mousedown",(n=>{n.preventDefault(),n.stopPropagation(),document.body.style.cursor="e-resize",t=n.x,e=Number(window.getComputedStyle(this.$chatView).width.replace("px","")),document.addEventListener("mousemove",s,!0),document.addEventListener("mouseup",i)}),!0)}}class x extends w.Z{constructor(t){super(),this.chatView=t,this.$stop=t.$chatView.$qs(".thread_op_stop"),this.$stop.addEventListener("click",(()=>{t.chatEngine.cencelGenerating()})),this.$regenerate=t.$chatView.$qs(".thread_op_regenerate"),this.$regenerate.addEventListener("click",(()=>{t.chatEngine.regenerate()})),this.bindEngineEvents()}bindEngineEvents(){this.chatView.chatEngine.on(f.TH.setStatus,(t=>{this.toggleStopGenerating([f.S2.generating,f.S2.fetching].includes(t)),this.toggleRegenerate([f.S2.cancel,f.S2.faild].includes(t))}))}toggleStopGenerating(t){(0,b.WB)(this.$stop,t)}toggleRegenerate(t){(0,b.WB)(this.$regenerate,t)}}class $ extends w.Z{constructor(t){super(),this.chatView=t,this.$userInput=t.$chatView.$qs(".input-area"),this.$sendBtn=t.$chatView.$qs(".operate_send"),this.engineStatus=f.S2.none,this.bindInput(),this.bindSendMessage(),this.bindEngineEvents(),this.bindPromptStatus(),this.lastSetBtnStyle=this.setBtnStyle()}bindInput(){this.$userInput.addEventListener("input",(()=>{this.setBtnStyle()}))}bindEngineEvents(){this.chatView.chatEngine.on(f.TH.setStatus,(t=>{this.enableUserInput(t!==f.S2.faild),this.handleMsgStatus(t)}))}bindPromptStatus(){this.chatView.elePrompt.on(f.ng.promptToggle,(()=>{this.setBtnStyle()}))}handleMsgStatus(t){this.engineStatus=t,this.setBtnStyle()}async setBtnStyle(){await this.lastSetBtnStyle;let t="";if([f.S2.none,f.S2.success,f.S2.cancel].includes(this.engineStatus)){if(!await this.getParsedMsg())return this.$sendBtn.classList.add("freezed"),void this.$sendBtn.setAttribute("title","Type a message");this.$sendBtn.classList.remove("freezed"),t="Send(Enter to send, Shift+Enter to break line)"}else this.$sendBtn.classList.add("freezed"),t=this.engineStatus===f.S2.faild?"Regenerating is worth a try":"Wait a moment";this.$sendBtn.setAttribute("title",t)}bindSendMessage(){const t=async()=>{const t=await this.getParsedMsg();t&&this.chatView.chatEngine.isEngineAvailable()&&(this.chatView.chatEngine.requestCompletion({userInput:t}),this.clearInput())};this.$sendBtn.addEventListener("click",t.bind(this)),this.$userInput.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),t.call(this))}))}async getParsedMsg(){const t=this.chatView.elePrompt.$getParsedPromt(),e=this.$userInput.value;if(!t)return e;let n=t;const s=/{{message}}/g,i=/{{activeNote}}/g;if(s.test(n)&&(n=n.replace(s,e)),i.test(n))try{n=n.replace(i,await this.chatView.chatData.getAcitveNoteContent())}catch(t){return console.error(t),null}return n.trim()}enableUserInput(t){this.$userInput.disabled=!t}clearInput(){this.$userInput.value=""}}const S={[f.S2.none]:"",[f.S2.fetching]:"Thinking...",[f.S2.generating]:"Typing...",[f.S2.faild]:f.S2.faild,[f.S2.cancel]:f.S2.cancel};class E{constructor(t){this.chatView=t,this.$status=t.$chatView.$qs(".operate_status"),t.chatEngine.on(f.TH.setStatus,(t=>{this.handleMsgStatus(t)}))}handleMsgStatus(t){const e=S[t];this.$status.textContent=e}handleDataStatus(t){const{status:e,key:n,value:s}=t;e===f.f5.success?this.$status.textContent="":this.$status.textContent=`${e}: ${n} - ${s}`}}class C{constructor(t){this.options=t.options,this.view=t,this.$face=t.$chatView.$qs(".header_face"),t.on(f.ng.viewShow,(()=>{this.refreshFace()}))}refreshFace(){const t=this.options[f.PV.faces],e=this.options[f.PV.colors],n=t[Math.floor(Math.random()*t.length)],s=e[Math.floor(Math.random()*e.length)];this.$face.classList.forEach((t=>{/bx.+/.test(t)&&this.$face.classList.remove(t)})),this.$face.style.color=s,this.$face.classList.add(n)}}class T{constructor(t){this.chatView=t,this.$collapse=t.$chatView.$qs(".header_hide"),this.bindCollapse()}bindCollapse(){this.$collapse.addEventListener("click",(()=>{this.chatView.hideView()}))}}const k=new Map;function L(t,e){return k.set(t,e),function(){k.delete(t)}}function O(t){k.forEach(((e,n)=>{n.contains(t.target)||e.call(n,t)}))}L.globalClick=O,document.addEventListener("click",O);const M={global:0,currentModal:null};class P{constructor({type:t="dialog",$content:e,$chatView:n}){this.type=t,this.wrapperClassName={popup:"content_wrapper_popup",dialog:"content_wrapper_dialog"}[t],this.$content=(0,b.hX)(e),this.$chatView=n,this.$modal=null,this.isShow=!1}async show(t){if(!this.isShow){if(this.$modal||this.initModal(),M.global+=1,this.$modal.style.zIndex=M.global,M.currentModal=M.global,this.$chatView.appendChild(this.$modal),(0,b.WB)(this.$modal,!0),this.$contentWrapper.classList.add(this.wrapperClassName),"popup"!==this.type){const{offsetWidth:e,offsetHeight:n}=this.$contentWrapper,{offsetLeft:s,offsetTop:i}=this.$chatView;this.$contentWrapper.style.left=t.x-s-e/2+"px",this.$contentWrapper.style.top=t.y-i-n/2+"px"}await(0,b.j1)(),(0,b.Yl)(this.$mask,!0),(0,b.Yl)(this.$contentWrapper,!0),this.isShow=!0}}initModal(){const t=document.createElement("template");t.innerHTML='<div class="chat_modal">\n<div class="modal_mask"></div>\n<div class="content_wrapper"></div>\n</div>',this.$modal=t.content.lastChild,this.$mask=this.$modal.$qs(".modal_mask"),this.$contentWrapper=this.$modal.$qs(".content_wrapper"),this.$contentWrapper.appendChild(this.$content),this.bindClick()}bindClick(){this.$mask.addEventListener("click",(t=>{this.hide()})),this.$contentWrapper.addEventListener("click",(t=>{}))}async hide(){if(!this.isShow)return;const t=()=>{(0,b.WB)(this.$modal,!1),this.$contentWrapper.style.left="initial",this.$contentWrapper.style.top="initial",this.$contentWrapper.classList.remove(this.wrapperClassName),(0,b.hX)(this.$modal),this.isShow=!1,M.currentModal=null,this.$mask.removeEventListener("transitionend",t)};this.$mask.addEventListener("transitionend",t),(0,b.Yl)(this.$mask,!1),(0,b.Yl)(this.$contentWrapper,!1)}}class H extends w.Z{constructor(t){super(),this.view=t,this.$content=t.$chatView.$qs(".content_select_history"),this.Modal=new P({type:"popup",$content:this.$content,$chatView:t.$chatView}),this.$showBtn=t.$chatView.$qs(".operate_btn_history"),this.$num=this.$content.$qs(".select_num"),this.$closeBtn=this.$content.$qs(".select_close"),this.$search=this.$content.$qs(".select_search_input"),this.$list=this.$content.$qs(".select_list"),this.$recordTpl=(0,b.hX)(this.$content.$qs(".select_item")),this.records=[],this.bindEvents(),t.on(f.ng.viewHide,(()=>{this.hide()}))}hide(){this.Modal.hide()}bindEvents(){this.$showBtn.addEventListener("click",(async t=>{this.Modal.show(t),this.loadHistory()})),this.$closeBtn.addEventListener("click",(()=>{this.hide()})),this.$search.addEventListener("input",(t=>{this.renderSearch(t.target.value)})),this.$list.addEventListener("click",(t=>{const e=(0,b.oq)("[data-id]",t.target);if(e){const t=this.records.find((t=>t.id===e.dataset.id));this.Modal.hide(),this.view.chatEngine.loadThread(t)}}))}async loadHistory(){const t=await this.view.chatData.getRecords();this.records=Object.keys(t).map((e=>({id:e,...t[e]})));const e=[...this.records.filter((t=>t.favor)).sort(this.sortByStamp),...this.records.filter((t=>!t.favor)).sort(this.sortByStamp)];this.renderCount(this.records.length),this.renderList(e)}sortByStamp(t,e){const n=t.list[t.list.length-1];return e.list[e.list.length-1].stamp-n.stamp}renderCount(t){this.$num.textContent=t}renderList(t){this.$list.innerHTML="";const e=document.createDocumentFragment();t.forEach((t=>{const n=t.list.find((t=>t.role===f.HB.assistant)),s=t.list[t.list.length-1],i=this.$recordTpl.cloneNode(!0);i.setAttribute("data-id",t.id),i.$qs(".item_title").textContent=t.title||t.originTitle,i.$qs(".item_stamp").textContent=(0,b.Sy)(s.stamp);const a=i.$qs(".item_preview");a.setAttribute("title",n.content),a.textContent=n.content,e.appendChild(i)})),this.$list.appendChild(e)}renderSearch(t){const e=this.records.filter((e=>e.list.some((e=>e.content.includes(t)))));this.renderList(e)}}class B extends w.Z{constructor(t){super(),this.$newBtn=t.$chatView.$qs(".operate_btn_new"),this.$newBtn.addEventListener("click",(()=>{t.chatEngine.newChat()}))}}const N={};class V{constructor({useTransition:t=!0,placement:e,offset:n,contentSelector:s,$edgeEle:i,$triggerEle:a,text:o,hideDelay:r,popoverClass:c}){if(this.placement=e,this.useTransition=t,this.offset=n,this.hideDelay=r,this.popoverClass=c,this.$triggerEle=a,o){const t=document.createElement("div");t.classList.add("tooltip-text"),t.innerHTML=o,this.$content=t}else N[s]=N[s]||(0,b.hX)(i.$qs(s)),this.$content=N[s];this.$edgeEle=i,this.$popover=null,this.isShow=!1}async show(){this.isShow||(this.$popover||this.initPopover(),this.$edgeEle.appendChild(this.$popover),this.$popover.appendChild(this.$content),this.setPopoverStyle(),(0,b.WB)(this.$popover,!0),await(0,b.j1)(),(0,b.Yl)(this.$popover,!0),this.OutsideUnbind=L(this.$popover,(()=>{M.currentModal&&M.currentModal>this.$popover.style.zIndex||(this.hide(),this.OutsideUnbind())})),this.isShow=!0,this.hideDelay&&setTimeout((()=>{this.hide()}),this.hideDelay))}setPopoverStyle(){const t=this.$edgeEle.getBoundingClientRect(),e=this.$triggerEle.getBoundingClientRect(),{top:n,left:s}=(0,b.Au)(t,e,this.$popover.offsetWidth,this.$popover.offsetHeight,this.offset,this.placement);this.$popover.style.top=`${n}px`,this.$popover.style.left=`${s}px`,this.$popover.style.bottom="initial",M.global+=1,this.$popover.style.zIndex=M.global}initPopover(){const t=document.createElement("div");t.classList.add("chat_popover"),this.popoverClass&&t.classList.add(this.popoverClass),[t.style.transformOrigin,t.style.transform]={top:["bottom","scaleY(0.01)"],bottom:["top","scaleY(0.01)"],left:["right","scaleX(0.01)"],right:["left","scaleX(0.01)"]}[this.placement],this.useTransition&&(t.style.transition="all .2s,opacity .15s"),this.$popover=t}async hide(){if(!this.isShow)return;const t=()=>{(0,b.WB)(this.$popover,!1),(0,b.hX)(this.$content),(0,b.hX)(this.$popover),this.OutsideUnbind(),this.$popover.removeEventListener("transitionend",t)};this.$popover.addEventListener("transitionend",t),(0,b.Yl)(this.$popover,!1),this.isShow=!1}}class q extends w.Z{constructor(t){super(),this.chatView=t,this.$content=t.$chatView.$qs(".content_command"),this.$showBtn=t.$chatView.$qs(".operate_btn_command"),this.popover=new V({placement:"top",contentSelector:".content_command",$edgeEle:t.$chatView,$triggerEle:this.$showBtn,offset:6}),this.bindShowClick(),this.bindClickCommand(),this.checkAutoSave()}checkAutoSave(){this.chatView.options.autoSave&&(this.$content.$qs("[command=history]").style.display="none")}bindShowClick(){this.$showBtn.addEventListener("click",(()=>{this.popover.show()}))}bindClickCommand(){this.$content.addEventListener("click",(t=>{const e=(0,b.oq)("[command]",t.target);if(!e)return;const n=e.getAttribute("command");this.excuteCommand(n)}))}async excuteCommand(t){try{await this.chatView.chatData.handleCommand(t,this.chatView.chatEngine),this.handleCommandSuccess(t)}catch(t){console.error(t),this.handleCommandFail(JSON.parse(t.message))}}get$commandByType(t){return this.$content.$qs(`[command=${t}]`)}showTooltip(t,e){new V({placement:"right",text:t,$edgeEle:this.chatView.$chatView,$triggerEle:e,offset:0,hideDelay:1e3}).show()}handleCommandSuccess(t){const e=this.get$commandByType(t);this.showTooltip("success",e)}handleCommandFail({type:t,reason:e}){const n=this.get$commandByType(t);this.showTooltip(e,n)}}class I extends w.Z{constructor({$content:t,$chatView:e,title:n,saveText:s="Save",cancelText:i="Cancel"}){super(),this.$wrapper=document.createElement("div"),this.$wrapper.innerHTML=`<div class="form_wrapper">\n        <div class="form_wrapper_top flex-center-between">\n            <div class="wapper_title">${n}</div>\n            <div class="wapper_close bx bx-x icon-action"></div>\n        </div>\n        <div class="wrapper_content"></div>\n        <div class="wrapper_op">\n            <button class="chat_button wrapper_btn_cancel">${i}</button>\n            <button class="chat_button wrapper_btn_save ml-1">${s}</button>\n        </div>\n    </div>`,this.$content=t,this.$chatView=e,this.$save=this.$wrapper.$qs(".wrapper_btn_save"),this.$wrapper.$qs(".wrapper_content").appendChild(t),e.appendChild(this.$wrapper),this.modal=new P({type:"dialog",$content:this.$wrapper,$chatView:e}),this.flagObj=null,this.bindEvents()}bindEvents(){this.$wrapper.$qs(".wapper_close").addEventListener("click",(t=>{this.emit(f.ng.formCancel)})),this.$save.addEventListener("click",(t=>{console.dir(this.$content);const e=Array.from(this.$content.querySelectorAll("[name]")).reduce(((t,e)=>(t[e.name]=e.value,e.value||this.showTooltip("no empty"),t)),{});this.emit(f.ng.formSave,e,this.flagObj)})),this.$wrapper.$qs(".wrapper_btn_cancel").addEventListener("click",(t=>{this.emit(f.ng.formCancel)}))}showTooltip(t){new V({placement:"top",text:t,$edgeEle:this.$chatView,$triggerEle:this.$save,offset:8,hideDelay:1e3}).show()}show(t,{title:e,formData:n={},flagObj:s}={}){e&&(this.$wrapper.$qs(".wapper_title").textContent=e),Array.from(this.$content.querySelectorAll("[name]")).forEach((t=>{t.value=n[t.name]||""})),this.flagObj=s,this.modal.show(t)}hide(){this.enable(!0),this.modal.hide()}enable(t){this.$wrapper.$qs(".wrapper_btn_save").disabled=!t,this.$wrapper.$qs(".wrapper_btn_cancel").disabled=!t}}class A extends w.Z{constructor(t){super(),this.chatView=t,this.$promptContent=t.$chatView.$qs(".prompt_content"),this.$content=t.$chatView.$qs(".content_select_prompt"),this.$showBtn=t.$chatView.$qs(".operate_btn_prompt"),this.Popover=new V({placement:"top",contentSelector:".content_select_prompt",$edgeEle:t.$chatView,$triggerEle:this.$showBtn,offset:5,popoverClass:"popover_prompt"}),this.$num=this.$content.$qs(".select_num"),this.$addBtn=this.$content.$qs(".select_add"),this.$closeBtn=this.$content.$qs(".select_close"),this.$search=this.$content.$qs(".select_search_input"),this.$list=this.$content.$qs(".select_list"),this.$promptTpl=(0,b.hX)(this.$content.$qs(".select_item")),this.$contentForm=t.$chatView.$qs(".content_prompt_form"),this.ModalForm=new I({$content:this.$contentForm,$chatView:t.$chatView,title:"Add temlate"}),this.prompts=[],this.bindEvents()}hide(){this.Popover.hide()}bindEvents(){this.$showBtn.addEventListener("click",(async t=>{this.Popover.show(t),this.loadPrompts()})),this.bindContentEvents(),this.bindListEvents(),this.bindFormEvents()}bindContentEvents(){this.$promptContent.$qs(".prompt_content_close").addEventListener("click",(()=>{this.$promptContent.style.height="0px",(0,b.WB)(this.$promptContent,!1),this.clearContent(),this.emit(f.ng.promptToggle,!1)}))}clearContent(){this.promptContent="",this.$text.innerHTML=""}bindListEvents(){this.$addBtn.addEventListener("click",(async t=>{this.ModalForm.show(t,{title:"Add temlate"})})),this.$closeBtn.addEventListener("click",(()=>{this.hide()})),this.$search.addEventListener("input",(t=>{this.renderSearch(t.target.value)})),this.$list.addEventListener("click",(async t=>{const e=(0,b.oq)("[data-id]",t.target);if(e){const n=this.prompts.find((t=>t.id===e.dataset.id));let s="select";if(t.target.classList.contains("bx-edit-alt")?s="edit":t.target.classList.contains("bx-trash")&&(s="delete"),"edit"===s)return void this.ModalForm.show(t,{title:"Edit temlate",formData:{"prompt-name":n.name,"prompt-content":n.content},flagObj:n});if("delete"===s)return await this.chatView.chatData.deletePrompt(n),void this.loadPrompts();this.handlePromptContent(n),this.Popover.hide()}}))}async handlePromptContent(t){this.promptContent=t.content,(0,b.WB)(this.$promptContent,!0),this.renderContent(t)}async renderContent(t){this.$text=this.$promptContent.$qs(".prompt_content_text"),this.$text.innerHTML=(0,b.Xj)(t.content),await(0,b.j1)(),this.$promptContent.style.height=`${this.$text.offsetHeight+40}px`,this.emit(f.ng.promptToggle,!0)}bindFormEvents(){this.ModalForm.on(f.ng.formSave,(async(t,e)=>{if(console.log(e),this.ModalForm.enable(!1),e){const n={...e,name:t["prompt-name"],content:t["prompt-content"]};await this.chatView.chatData.updatePrompt(n)}else{const e={name:t["prompt-name"],content:t["prompt-content"],id:Date.now().toString()};await this.chatView.chatData.createPrompt(e)}this.ModalForm.hide(),this.loadPrompts()})),this.ModalForm.on(f.ng.formCancel,(()=>{this.ModalForm.hide()}))}async loadPrompts(){this.prompts=(await this.chatView.chatData.getPrompts()||[]).sort(((t,e)=>e.order-t.order)),this.renderCount(this.prompts.length),this.renderList(this.prompts)}renderCount(t){this.$num.textContent=t}renderList(t){this.$list.innerHTML="";const e=document.createDocumentFragment();t.forEach((t=>{const n=this.$promptTpl.cloneNode(!0);n.setAttribute("data-id",t.id),n.$qs(".item_title").textContent=t.name;const s=n.$qs(".item_preview");s.setAttribute("title",t.content),s.textContent=t.content,e.appendChild(n)})),this.$list.appendChild(e)}renderSearch(t){const e=this.prompts.filter((e=>e.name.includes(t)||e.content.includes(t)));this.renderList(e)}$getParsedPromt(){return this.promptContent?(0,b.jN)(this.$promptContent,this.promptContent):""}}class R extends w.Z{constructor({options:t,chatData:e,chatEngine:n}){super(),this.options=t,this.chatData=e,this.chatEngine=n,this.appendEleToHost(),this.$chatView=null,this.initSkeleton(),this.activateElements(),this.initViewWidth(),this.bindListeners()}appendEleToHost(){this.appendToggleBtn()}appendToggleBtn(){(0,b.de)()}initSkeleton(){(0,b.de)()}activateElements(){this.eleThread=new _(this),this.eleResizer=new y(this),this.eleGenerate=new x(this),this.elePrompt=new A(this),this.eleInput=new $(this),this.eleStatus=new E(this),this.eleFace=new C(this),this.eleCollapse=new T(this),this.eleHistory=new H(this),this.eleNewChat=new B(this),this.eleCommand=new q(this)}initViewWidth(){this.$chatView.style.width=`${this.options[f.PV.viewWidth]}px`}bindListeners(){this.bindShortcut()}bindShortcut(){(0,b.de)()}showView(){this.emit(f.ng.viewShow),this.$chatView.classList.add(f.f1)}hideView(){this.emit(f.ng.viewHide),this.$chatView.classList.remove(f.f1)}isViewShow(){return this.$chatView.classList.contains(f.f1)}toggleView(){this.isViewShow()?this.hideView():this.showView()}}},302:(t,e,n)=>{n.d(e,{Z:()=>a});var s=n(257),i=n(46);class a extends i.Z{initSkeleton(){this.$chatView=document.$qs(".chat-wrapper"),this.$chatView.style.display="flex"}appendEleToHost(){this.appendToggleBtn(),s.r8&&this.appendCreateMsgBtn()}appendToggleBtn(){const t=document.$qs(".operation"),e=document.createElement("button");e.textContent="toggle",e.addEventListener("click",(()=>{this.toggleView()})),t.appendChild(e)}appendCreateMsgBtn(){const t=document.$qs(".operation"),e=document.createElement("button");e.textContent="createMsg",e.addEventListener("click",(()=>{[{role:s.HB.user,content:"this is a test message"},{role:s.HB.assistant,content:"true"},{role:s.HB.user,content:"can you tell me a story?"},{role:s.HB.assistant,content:"Sure, I'd love to tell you a story. Here's one I know:\n\n                Once upon a time, in a far-off land, there was a poor farmer named Jack. Jack had a small piece of land and a few animals, but he struggled to make ends meet. One day, while plowing his field, Jack found a shiny golden egg. He couldn't believe his luck!\n                \n                Jack took the egg to the market and sold it for a good price. The next day, he found another golden egg. And the day after that, and the day after that. Every day, Jack found a new golden egg, and he became very rich.\n                \n                But Jack grew greedy. He thought to himself, \"If I could get all the eggs at once, I'd be the richest man in the world!\" So he killed the goose that laid the golden eggs, hoping to find all the eggs inside.\n                \n                But when he opened the goose, there were no eggs. Jack had killed the goose that had given him so much wealth and happiness.\n                \n                The moral of the story is: greed can lead to loss. It's important to be grateful for what we have and not to take it for granted."}].forEach((t=>{this.eleThread.appendElByMessage(t)}))})),t.appendChild(e)}bindShortcut(){window.addEventListener("keydown",(t=>{t.altKey&&"q"===t.key?this.toggleView():"Escape"===t.key&&(console.log(t),this.isViewShow()&&(t.preventDefault(),t.stopPropagation(),this.hideView()))}),!0)}}},257:(t,e,n)=>{n.d(e,{HB:()=>a,HT:()=>f,PV:()=>u,S2:()=>p,TH:()=>r,Ve:()=>g,WN:()=>w,bs:()=>h,cQ:()=>m,cT:()=>v,f1:()=>d,f5:()=>l,jU:()=>i,ng:()=>o,r8:()=>s,xL:()=>c});const s=!1,i=!0,a={system:"system",user:"user",assistant:"assistant",error:"error"},o={viewShow:"viewShow",viewHide:"viewHide",formSave:"formSave",formCancel:"formCancel",promptToggle:"promptToggle"},r={create:"create",append:"append",replace:"replace",cancel:"cancel",setStatus:"setStatus",load:"load"},c={copy:"copy",history:"history",favor:"favor",unfavor:"unfavor",save:"save",append:"append",child:"child"},h={setStatus:"setStatus"},l={optionSyncing:"optionSyncing",success:"success",faild:"faild"},p={none:"none",fetching:"fetching",generating:"generating",success:"success",faild:"faild",cancel:"cancel"},d="show",m="fadein",u={viewWidth:"viewWidth",faces:"faces",colors:"colors"};if(s)throw new Error("APIKEY not found, please create .env.dev and set your APIKEY");const g="TRILIUM_ONLY",v={CHAT_OPTIONS:"CHAT_OPTIONS",CHAT_PROMPTS:"CHAT_PROMPTS",HISTORY_LABEL:"CHAT_HISTORY_ID",HISTORY_HOME_LABEL:"CHAT_HISTORY_HOME"},w={viewWidth:400,engine:"chatGpt",apiKey:"",engineOptions:{model:"gpt-3.5-turbo",max_tokens:2500,temperature:.3,top_p:1,presence_penalty:.5,frequency_penalty:.5,stream:!0,n:1},shortcut:{toggle:"Alt+Q",hide:"Esc"},faces:["bx-smile","bx-wink-smile","bx-face","bx-happy-alt","bx-cool","bx-laugh","bx-upside-down"],colors:["var(--muted-text-color)"],autoSave:!0,systemPrompt:"You are a helpful assistant that integrates AI to Trilium note-taking."},f=[{id:"official-0",name:"translate",content:"Translate the following content to {{language:English|Chinese|Franch}} language: \n {{message}}",order:0},{id:"official-1",name:"translateNote",content:"Translate the following content to {{language:English|Chinese|Franch}} language: \n {{activeNote}}",order:1}]},225:(t,e,n)=>{n.a(t,(async(t,e)=>{try{var s=n(926),i=n(302),a=n(396),o=n(300),r=n(0),c=n(257),h=n(624);class t{constructor(){this.init()}async init(){const t=this.setChatData(),e=await t.initOptions();await t.initPrompts();const n=this.getEngine(e);this.setView({chatData:t,options:e,chatEngine:n}),n.newChat()}setChatData(){return this.chatData=c.jU?new o.Z:new r.Z,this.chatData.on(c.bs.setStatus,(t=>{this.chatView.eleStatus.handleDataStatus(t)})),this.chatData}getEngine(t){let e;return"chatGpt"===t.engine&&(e=new s.Z(t)),e.on(c.TH.setStatus,(n=>{t.autoSave&&this.chatData.handleMsgStatus(n,e)})),e}async setView(t){const e=c.jU?i.Z:a.Z;this.chatView=new e(t)}}Element.prototype.$qs=Element.prototype.querySelector,Document.prototype.$qs=Document.prototype.querySelector,await(0,h.j1)(),window._triliumChat=new t,e()}catch(t){e(t)}}),1)},624:(t,e,n)=>{n.d(e,{Au:()=>b,JG:()=>_,P2:()=>o,Sy:()=>w,WB:()=>l,Xj:()=>x,Yl:()=>p,Yo:()=>u,_o:()=>c,_v:()=>d,de:()=>r,hX:()=>g,j1:()=>v,jN:()=>$,oq:()=>f,rs:()=>a,tY:()=>m});var s=n(257);const i={};function a(t,e="default"){return!i[e]&&(i[e]=!0,window.requestAnimationFrame((n=>{i[e]=!1,t(n)})),!0)}function o(t,e){let n=0;return function(...s){const i=(new Date).getTime();i-n>=e&&(t.apply(this,s),n=i)}}function r(t){if(!t)throw new Error("should implement in child classes")}function c(t,e){throw new Error(JSON.stringify({type:t,reason:e}))}function h(t,e,n){"boolean"==typeof e?e?t.classList.add(n):t.classList.remove(n):t.classList.contains(n)?t.classList.remove(n):t.classList.add(n)}function l(t,e){h(t,e,s.f1)}function p(t,e){h(t,e,s.cQ)}async function d(t){await new Promise((e=>{setTimeout(e,t)}))}function m(t,e){let n=!1;return Object.keys(t).forEach((t=>{t in e||(n=!0)})),n}function u(t,e){const n={...e};return Object.keys(t).forEach((s=>{s in e&&(n[s]=t[s])})),n}function g(t){if(t.parentElement)return t.parentElement.removeChild(t)}async function v(){await d(10)}function w(t){const e=Math.floor((new Date-new Date(t))/1e3);let n=Math.floor(e/31536e3);return n>=1?`${n} year${1===n?"":"s"} ago`:(n=Math.floor(e/2592e3),n>=1?`${n} month${1===n?"":"s"} ago`:(n=Math.floor(e/86400),n>=1?`${n} day${1===n?"":"s"} ago`:(n=Math.floor(e/3600),n>=1?`${n} hour${1===n?"":"s"} ago`:(n=Math.floor(e/60),n>=1?`${n} minute${1===n?"":"s"} ago`:0===e?"just now":`${Math.floor(e)} second${1===Math.floor(e)?"":"s"} ago`))))}function f(t,e){return e?.matches?e.matches(t)?e:f(t,e.parentNode):null}function b(t,e,n,s,i,a){let o,r;switch(a){case"top":default:o=e.left+e.width/2-n/2,r=e.top-s-i;break;case"left":o=e.left-n-i,r=e.top+e.height/2-s/2;break;case"right":o=e.left+e.width+i,r=e.top+e.height/2-s/2;break;case"bottom":o=e.left+e.width/2-n/2,r=e.top+e.height+i}o-=t.left,r-=t.top;const c=t.width,h=t.height;return o<0?o=0:o+n>c&&(o=c-n),r<0?r=0:r+s>h&&(r=h-s),{left:o,top:r}}const _=t=>{navigator.clipboard.writeText(t)},y=/{{([^}]+):([^}]+)}}/g,x=t=>{let e,n=t;for(;null!==(e=y.exec(n));){const t=e[0],s=`<select name="${e[1].trim()}">${e[2].split("|").map((t=>t.trim())).map((t=>`<option value="${t}">${t}</option>`)).join("")}<select>`;n=n.replace(t,s)}return y.lastIndex=0,n},$=(t,e)=>{let n=e;return Array.from(t.querySelectorAll("select")).forEach((t=>{const e=y.exec(n)[0];n=n.replace(e,t.value)})),y.lastIndex=0,n}}},a={};function o(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={id:t,exports:{}};return i[t](n,n.exports,o),n.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(i,a,o)=>{var r;o&&((r=[]).d=1);var c,h,l,p=new Set,d=i.exports,m=new Promise(((t,e)=>{l=e,h=t}));m[e]=d,m[t]=t=>(r&&t(r),p.forEach(t),m.catch((t=>{}))),i.exports=m,a((i=>{var a;c=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[t])return i;if(i.then){var a=[];a.d=0,i.then((t=>{o[e]=t,s(a)}),(t=>{o[n]=t,s(a)}));var o={};return o[t]=t=>t(a),o}}var r={};return r[t]=t=>{},r[e]=i,r})))(i);var o=()=>c.map((t=>{if(t[n])throw t[n];return t[e]})),h=new Promise((e=>{(a=()=>e(o)).r=0;var n=t=>t!==r&&!p.has(t)&&(p.add(t),t&&!t.d&&(a.r++,t.push(a)));c.map((e=>e[t](n)))}));return a.r?h:o()}),(t=>(t?l(m[n]=t):h(d),s(r)))),r&&(r.d=0)},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.nc=void 0,o(225)})();